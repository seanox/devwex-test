<?xml version="1.0" ?>
<project name="devwex-test" default="compile" basedir="..">
  
  <property name="workspace" value="."/>
  <property name="workspace.resources" value="${workspace}/resources"/>  
  <property name="workspace.resources.libraries" value="${workspace.resources}/libraries"/>
  <property name="workspace.resources.program" value="${workspace.resources}/program"/>
  <property name="workspace.resources.certificates" value="${workspace.resources}/certificates"/>
  
  <target name="compile">
    <delete file="${workspace.resources.libraries}/ConnectorA.class"/>
    <delete file="${workspace.resources.libraries}/connectorA.jar"/>
    <javac srcdir="${workspace.resources.libraries}" destdir="${workspace.resources.libraries}"
      includeantruntime="false"/>
    <jar destfile="${workspace.resources.libraries}/connectorA.jar"
       basedir="${workspace.resources.libraries}"
       includes="ConnectorA.class"/>
    
    <delete file="${workspace.resources.libraries}/ConnectorB.class"/>
    <delete file="${workspace.resources.libraries}/connectorB.jar"/>
    <javac srcdir="${workspace.resources.libraries}" destdir="${workspace.resources.libraries}"
      includeantruntime="false"/>
    <jar destfile="${workspace.resources.libraries}/connectorB.jar"
       basedir="${workspace.resources.libraries}"
       includes="ConnectorB.class"/> 
    
    <delete file="${workspace.resources.libraries}/ConnectorC.class"/>
    <delete file="${workspace.resources.libraries}/connectorC.jar"/>
    <javac srcdir="${workspace.resources.libraries}" destdir="${workspace.resources.libraries}"
      includeantruntime="false"/>
    <jar destfile="${workspace.resources.libraries}/connectorC.jar"
       basedir="${workspace.resources.libraries}"
       includes="ConnectorC.class"/>      
    
    <delete file="${workspace.resources.libraries}/ConnectorD.class"/>
    <delete file="${workspace.resources.libraries}/connectorD.jar"/>
    <javac srcdir="${workspace.resources.libraries}" destdir="${workspace.resources.libraries}"
      includeantruntime="false"/>
    <jar destfile="${workspace.resources.libraries}/connectorD.jar"
       basedir="${workspace.resources.libraries}"
       includes="ConnectorD.class"/>

    <delete file="${workspace.resources.libraries}/ConnectorE.class"/>
    <delete file="${workspace.resources.libraries}/connectorE.jar"/>
    <javac srcdir="${workspace.resources.libraries}" destdir="${workspace.resources.libraries}"
      includeantruntime="false"/>
    <jar destfile="${workspace.resources.libraries}/connectorE.jar"
       basedir="${workspace.resources.libraries}"
       includes="ConnectorE.class"/>
    
    <delete file="${workspace.resources.libraries}/ConnectorF.class"/>
    <delete file="${workspace.resources.libraries}/connectorF.jar"/>
    <javac srcdir="${workspace.resources.libraries}" destdir="${workspace.resources.libraries}"
      includeantruntime="false"/>
    <jar destfile="${workspace.resources.libraries}/connectorF.jar"
       basedir="${workspace.resources.libraries}"
       includes="ConnectorF.class"/>    
    
    <delete file="${workspace.resources.libraries}/Scripting.class"/>
    <delete file="${workspace.resources.libraries}/scripting.jar"/>
    <javac srcdir="${workspace.resources.libraries}" destdir="${workspace.resources.libraries}"
      includeantruntime="false"/>
    <jar destfile="${workspace.resources.libraries}/scripting.jar"
       basedir="${workspace.resources.libraries}"
       includes="Scripting.class">
       <manifest>
         <attribute name="Main-Class" value="Scripting"/>
       </manifest>      
    </jar>
    
    <delete file="${workspace.resources.libraries}/ConnectorA.class"/>
    <delete file="${workspace.resources.libraries}/ConnectorB.class"/>
    <delete file="${workspace.resources.libraries}/ConnectorC.class"/>
    <delete file="${workspace.resources.libraries}/ConnectorD.class"/>    
    <delete file="${workspace.resources.libraries}/ConnectorE.class"/>
    <delete file="${workspace.resources.libraries}/ConnectorF.class"/>
    <delete file="${workspace.resources.libraries}/Scripting.class"/>
  </target>
  
  <target name="keystore">
    <delete dir="${workspace.resources.certificates}"/>
    <mkdir dir="${workspace.resources.certificates}"/>
    <exec executable="keytool">
      <arg line="-genkeypair -alias ServerKey -keyalg RSA -keysize 2048 -validity 365
        -dname 'CN=127.0.0.1,O=Seanox Software Solutions,L=Berlin,ST=Germany,C=DE'
        -keystore ${workspace.resources.certificates}/server_ma.jks -keypass changeIt -storepass changeIt"/>
    </exec>    
    <exec executable="keytool">
      <arg line="-genkeypair -alias ClientKey -keyalg RSA -keysize 2048 -validity 365
        -dname 'CN=127.0.0.1,O=Seanox Software Solutions,L=Berlin,ST=Germany,C=DE'
        -keystore ${workspace.resources.certificates}/client_ma.jks -keypass changeIt -storepass changeIt"/>
    </exec>    
    <exec executable="keytool">
      <arg line="-exportcert -alias ClientKey -keystore ${workspace.resources.certificates}/client_ma.jks -storepass changeIt
        -file ${workspace.resources.certificates}/client_public.cer"/>
    </exec>    
    <exec executable="keytool">
      <arg line="-importcert -alias ClientCer -keystore ${workspace.resources.certificates}/server_ma.jks -storepass changeIt
        -file ${workspace.resources.certificates}/client_public.cer -noprompt"/>
    </exec>     
    <exec executable="keytool">
      <arg line="-exportcert -alias ServerKey -keystore ${workspace.resources.certificates}/server_ma.jks -storepass changeIt
        -file ${workspace.resources.certificates}/server_public.cer"/>
    </exec> 
    <exec executable="keytool">
      <arg line="-importcert -alias ServerCer -keystore ${workspace.resources.certificates}/client_ma.jks -storepass changeIt
        -file ${workspace.resources.certificates}/server_public.cer -noprompt"/>
    </exec>
    <exec executable="keytool">
      <arg line="-importkeystore -srckeystore ${workspace.resources.certificates}/server_ma.jks -destkeystore ${workspace.resources.certificates}/server.p12
        -deststoretype PKCS12 -keypass changeIt -storepass changeIt -srcstorepass changeIt -noprompt"/>
    </exec>
    <exec executable="keytool">
      <arg line="-importkeystore -srckeystore ${workspace.resources.certificates}/client_ma.jks -destkeystore ${workspace.resources.certificates}/client.p12
        -deststoretype PKCS12 -keypass changeIt -storepass changeIt -srcstorepass changeIt -noprompt"/>
    </exec>        
    <exec executable="keytool">
      <arg line="-genkey -alias seanox.local -keyalg RSA -keysize 2048 -validity 365
        -dname 'CN=127.0.0.1,O=Seanox Software Solutions,L=Berlin,ST=Germany,C=DE'
        -keystore '${workspace.resources.certificates}/server.jks' -keypass changeIt -storepass changeIt"/>
    </exec>
      <exec executable="keytool">
        <arg line="-genkey -alias seanox.local -keyalg RSA -keysize 2048 -validity 365
          -dname 'CN=127.0.0.1,O=Seanox Software Solutions,L=Berlin,ST=Germany,C=DE'
          -keystore '${workspace.resources.certificates}/client.jks' -keypass changeIt -storepass changeIt"/>
      </exec>    
  </target>   
</project>